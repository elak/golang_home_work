# ТЗ на сервис "Составление плейлистов"

## Общее описание

Сервис "Составление плейлистов" предназначен для составления списков воспроизведения указанной длительности по
алгоритму, заданному выбранной стратегией заполнения.

Предположим, что есть коллекция видео, где каждый ролик относится к какой-то одной категории Есть несколько устоявшихся
шаблонов просмотра этой коллекции: "Утреннее музыкально-развлекательное шоу", "Вечер документального кино", "Час
мультфильмов перед сном" и т.д.

При этом мы можем не хотеть видеть много однотипных видео подряд или слишком часто видеть одно и то же.

Алгоритмически задача сводится к "Укладке рюкзака", где весом является длительность ролика, а цена и состав предметов
определяется выбранной стратегией.

## Архитектура

Сервис состоит из API и базы данных в которой хранится информация о сущностях (ролики, группу, стратегии). Сервис должен
предоставлять REST API.

## Описание сущностей

### Категория

Категория - метка ролика или группы роликов. Используется в фильтрах и ограничения стратегий заполнения

* ID
* Описание

### Группа роликов

Группа роликов - иерархическая структура роликов

* ID
* Описание
* ID группы-родителя
* Категория

### Ролик

Ролики - элемент плейлиста

* ID
* Описание
* ID группы-родителя
* Порядок в группе
* ID Категории
* Длительность

Один ролик входит в одну группу и относится к одной категории. Если ролику не указана категория - он относится к
категории группы-родителя. Ролики, не относящиеся ни к одной категории, не включаются в плейлисты

### Стратегия

Стратегия - набор приоритетов и ограничений заполнения списка

* ID
* Описание
* Блок начальных элементов
* Блок Повторяемых элементов
* Блок завершающих элементов
* Ограничения

### Элемент стратегии

Элемент стратегии - набор приоритетов и ограничений заполнения списка

* ID
* Описание
* ID стратегии
* Порядок в группе
* Длительность
* Выбираемые категории
* Параметры заполнения
* Ограничения

### Параметр заполнения

* ID
* Порядок выполнения
* ID выбираемой категории
* Выбор среди уже просмотренного
* Порядок роликов - строгий/случайный
* Порядок групп - по числу просмотров/длительности просмотров/последнему просмотру

Задаёт список роликов и приоритетность их добавления в список для шага стратегии

### Ограничения

* ID
* Описание
* Область применения - группа/категория
* ID ограничиваемой группы
* ID ограничиваемой категории
* Ограничение длительности
* Ограничение количества

Ограничения могут быть связаны как с отдельным элементом стратегии, так и со стратегией в целом. В первом случае
ограничение действует только на заполняемый отрезок списка, а во втором - на весь список

Позволяет задавать условия вида "Не больше 4 штук(40 минут) роликов из одной группы(категории) за час(за всё время)"

## Описание методов

### Добавить категорию

* ID
* Описание

### Изменить категорию

* ID
* Описание

### Удалить категорию

* ID

### Добавить группу роликов

* ID
* Описание
* ID группы-родителя
* Категория

### Изменить группу роликов

* ID
* Описание
* ID группы-родителя
* Категория

### Удалить группу роликов

* ID

### Добавить Ролик

* ID
* Описание
* ID группы-родителя
* Порядок в группе
* ID Категории
* Длительность

### Изменить Ролик

* ID
* Описание
* ID группы-родителя
* Порядок в группе
* ID Категории
* Длительность

### Удалить Ролик

* ID

### Добавить стратегию

* ID
* Описание
* Блок начальных элементов
* Блок Повторяемых элементов
* Блок завершающих элементов
* Ограничения

Стратегия записывается вместе со своими вложенными сущностями(шаги, ограничения, настройки заполнения)

### Изменить стратегию

* ID
* Описание
* ID начального элемента
* ID завершающего элемента
* Блок начальных элементов
* Блок Повторяемых элементов
* Блок завершающих элементов
* Ограничения
  
Стратегия записывается вместе со своими вложенными сущностями(шаги, ограничения, настройки заполнения)

### Удалить стратегию

* ID

### Засчитать просмотр

Добавляет ролик в историю просмотров за указанную дату.

* ID ролика
* Дата просмотра

### Составить плейлист

Основной метод. Возвращает список роликов указанной длины, заполненный с использованием указанной стратегии. Принимает:

* Длительность
* ID стратегии

Возвращает:

* Список роликов

## Конфигурация

Развертывание микросервиса должно осуществляться командой `make run` (внутри `docker compose up`)
в директории с проектом.

## Тестирование

Тестирование алгоритма "укладки рюкзака" для различных сочетаний списка роликов, стратегий, историй просмотра.
Интеграционные тесты проверяющие работу сервиса через его API.
